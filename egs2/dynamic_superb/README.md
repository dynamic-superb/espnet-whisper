# STEPS TO RUN WHISPER MULTITASK
- Change whisper/tokenize.py in your installation of whisper to  local/whisper_tokenizer.py
- Create dump directory using ``./run.sh --stop_stage 4`` in the following recipes i.e. ``asvspoof,speechcommands,grabo,lt_speech_commands,arabic_sc,fsc,voxforge/lid1,iemocap,accentdb,Mustard,Mustard_plus_plus,voxceleb1,freesound esc50``. You will have to download all the dataset zip files first before creating dump directory. Please refer to ``https://github.com/ga642381/SpeechPrompt-v2/blob/main/docs/dataset.md`` to download all datasets.
- Run ``python create_better_*.py`` and ``python create_*_prompt.py`` to ensure that none of task labels overlap
- Concatenate ``wav.scp,prompt,text,utt2spk,spk2utt,utt2num_samples`` of all train and valid dump folder in each of the directory and create   ``dump/raw/train_combined`` and ``dump/raw/valid`` in this recipe.
- Then run ``./run.sh --stage 5 --stop_stage 11 --ngpu 4`` in this recipe
- Run decoding for each of datasets in ``./run.sh --stage 12 --stop_stage 12 --use_lang_prompt true --inference_nj 4 --inference_config conf/decode_asr_fsd.yaml --gpu_inference true --ngpu 1 --asr_config conf/train_asr_whisper_full_correct_specaug.yaml --test_sets test_asvspoof`` where you need to change inference config to conf/decode_asr_<task>.yaml and test_set to test_<dataset>
- For some tasks, you need to clean prediction files using ``python clean_emotion_pred.py``, ``python check_lid_results.py``, ``python check_vad_results.py``
- Run ``./run.sh --stage 13 --stop_stage 13 --use_lang_prompt true --inference_nj 4 --inference_config conf/decode_asr_fsd.yaml --gpu_inference true --ngpu 1 --asr_config conf/train_asr_whisper_full_correct_specaug.yaml --test_sets test_asvspoof`` to get accuracy. For tasks where you need to compute f1 or weighted_f1 (Sarcasm detection), run ``python local/compute_f1.py`` and ``python local/compute_weighted_f1.py``
